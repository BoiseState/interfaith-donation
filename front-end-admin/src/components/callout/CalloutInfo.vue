<template>
  <div class="jumbotron">
    <div class="container">
      <h2>{{callout.title}}</h2>
      <!-- TODO: List out associated needs with a specific callout -->
      <h2>Update Callout Information</h2>
      <b-form v-on:submit.prevent="onFormSubmit">
        <div class="form-group">
          <label class="control-label col-sm-2">Title:</label>
          <input v-model="callout.name" type="text" width="50" required>
        </div>
        <div class="form-group">
          <label class="control-label col-sm-2">Description:</label>
          <textarea rows="4" cols="50" v-model="callout.descriptionMessage"></textarea>
        </div>
        <div class="form-group">
          <label class="control-label col-sm-4>">Status: </label>
          <input type="checkbox" v-model="callout.active">Active?<br>
        </div>
        <div>
          <b-btn v-b-modal.modal>Add Need</b-btn>
        </div>
        <br>
        <button class="btn btn-primary" type="submit">Update Callout</button>
      </b-form>
    </div>
    <div>
      <!-- Modal Component -->
      <b-modal id="modal" size="lg" @ok="handleOk" centered title="Bootstrap-Vue">
        <NeedSelect></NeedSelect>
      </b-modal>
    </div>
  </div>
</template>

<script>
import { getCalloutById, updateCallout } from '../../services/callout-service';
import { updateCalloutNeed } from '../../services/calloutneed-service';

import NeedSelect from '../need/NeedSelect';

export default {
  name: 'callout-info',
  components: {
    NeedSelect
  },
  data() {
    return {
      callout: {
        title: 'Loading...',
        body: '',
        url: '',
        createDate: '',
        updateDate: '',
        active: '',
        pinned: ''
      },
      calloutNeeds: [],
      newCalloutNeed: {}
    };
  },
  created() {
    getCalloutById(this.$route.params.id).then(callout => {
      callout.id = this.$route.params.id;
      this.callout = callout;
      this.calloutNeeds = callout.calloutNeeds;
    });
  },
  methods: {
    onFormSubmit() {
      this.callout.calloutNeeds.forEach(calloutNeed => {
        updateCalloutNeed(calloutNeed);
      });
      updateCallout(this.callout);
    },
    handleOk(evt) {
      // Prevent modal from closing
      evt.preventDefault();
      if (!this.name) {
        alert('Please enter your name');
      } else {
        this.handleSubmit();
      }
    },
    handleSubmit() {
      this.calloutNeeds.push(this.newCalloutNeed);
      this.clearCalloutNeed();
    },
    clearCalloutNeed() {
      this.newCalloutNeed = {};
    }
  }
};
</script>

<style scoped>
table td {
  padding: 0px 10px 0px 10px; /* top right bottom left */
}
table th {
  padding: 0px 10px 0px 10px; /* top right bottom left */
}
</style>
